<section class="view modelWorkspace workspaceLogic">
	<header class="navbar navbar-default navbar-fixed-top">
		<ul class="nav navbar-nav pull-left">
			<li>
				<a class="back-button" href="#" data-ui-sref="main">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
				</a>
			</li>
		</ul>

		<div class="navbar-header">
			<strong class="navbar-brand">{{ 'BR Modelo Web' | translate }}</strong>
		</div>
		<img
			src="../../img/loading-dots.gif"
			alt="Loading"
			class="br-loader"
			ng-class="{'loading': $ctrl.loading}"
		/>
	</header>

	<section class="mainContent">
		<section class="elements-holder">
			<!-- Insert elements to be used in model constrution -->
		</section>

		<section id="content" class="model-area">
			<header class="workspace-header">
				<div class="page-header clearfix">
					<div class="document-info pull-left">
						<h2 class="h4 pull-left">{{ 'Logical model of:' | translate }} {{$ctrl.model.name}}</h2>
						<status-bar updated-at="$ctrl.modelState.updatedAt"></status-bar>
					</div>
					<aside class="header-actions pull-right">
						<a class="br-button" data-ng-click="$ctrl.saveModel()" title="{{ 'Save (CTRL S)' | translate }}">{{ 'Save' | translate }}</a>
					</aside>
				</div>
				<ul class="nav navbar-nav tool-icons">
					<li><a data-ng-click="$ctrl.undoModel()" title="{{ 'Undo (CTRL Z)' | translate }}"><i class="fa fa-reply"></i></a></li>
					<li class="divider"><a data-ng-click="$ctrl.redoModel()" title="{{ 'Redo (CTRL SHIFT Z)' | translate }}"><i class="fa fa-share"></i></a></li>
					<li><a data-ng-click="$ctrl.zoomIn()" title="{{ 'Zoom in (Z +)' | translate }}"><i class="fa fa-search-plus"></i></a></li>
					<li><a data-ng-click="$ctrl.zoomNone()" title="{{ 'Zoom 100% (Z 0)' | translate }}"><i class="fa fa-search"></i></a></li>
					<li class="divider"><a data-ng-click="$ctrl.zoomOut()" title="{{ 'Zoom out (Z -)' | translate }}"><i class="fa fa-search-minus"></i></a></li>
					<li><a data-ng-click="$ctrl.duplicateModel()" title="{{ 'Duplicate model' | translate }}"><i class="fa fa-files-o"></i></a></li>
					<li class="divider"><a data-ng-click="$ctrl.generateSQL()" title="{{ 'Generate SQL' | translate }}"><i class="fa fa-database"></i></a></li>
					<li class="divider"><a data-ng-click="$ctrl.print()" title="{{ 'Print (CTRL P)' | translate }}"><i class="fa fa-print"></i></a></li>
				</ul>
				<aside class="feedback">
					<div class="alert alert-success" role="alert" data-ng-class="{'hide': !$ctrl.feedback.showing}">
						<p>{{ $ctrl.feedback.message }}</p>
					</div>
				</aside>
			</header><!-- End .workspace-header -->

			<aside class="model-properties" data-ng-class="{'active': $ctrl.editionVisible}">

				<span class="action" data-ng-click="$ctrl.changeVisible()">
					<i class="fa angle-double-icon" data-ng-class="$ctrl.editionVisible ? 'fa-angle-double-right' : 'fa-angle-double-left'"></i>
				</span>

				<div class="properties-content" ng-if="$ctrl.selectedElement == null">
					<div class="form-group">
						<div class="empty-state">
							<label for="entry-name">{{ 'Select an element to edit' | translate }}</label>
						</div>
					</div><!-- End .form-group -->
				</div>

				<div class="properties-content" ng-show="$ctrl.selectedElement != null">

					<div class="form-group">
						<label for="entry-name">{{ 'Name' | translate }}</label>
						<input
							id="entry-name"
							type="text"
							class="form-control"
							ng-model="$ctrl.selectedName"
							ng-change="$ctrl.changeName()"
						/>
					</div><!-- End .form-group -->

					<section class="columnsList">
						<header class="clearfix">
							<label>{{ 'Columns' | translate }}</label>
							<i class="fa fa-plus-circle addColumn" aria-hidden="true" ng-click="$ctrl.showAddColumn(true)"></i>
						</header>

						<div class="columnItem" ng-show="$ctrl.addColumnVisible">
							<div class="form-group">
								<label for="column-name">{{ 'Name' | translate }}</label>
								<input
									id="entry-name"
									type="text"
									class="form-control"
									ng-model="$ctrl.addColumnModel.name"
								/>
							</div>

							<div class="form-group clearfix">
								<label for="">{{ 'Type' | translate }}</label>
									<dropdown
										on-select="$ctrl.selectAddType(selected)"
										selected="{name: 'INT', type: 'ORIGEM'}"
										options="[{name: 'DATE', type: 'DATE'}, {name: 'FLOAT', type: 'FLOAT'}, {name: 'VARCHAR(n)', type: 'VARCHAR(n)'}, {name: 'CHAR(n)', type: 'CHAR(n)'},  {name: 'INT', type: 'INT'}]">
									</dropdown>
							</div>

							<div class="form-group">
								<label for="default">{{ 'Default' | translate }}</label>
								<input
									id="default"
									type="text"
									class="form-control"
									ng-model="$ctrl.addColumnModel.defaultValue"
								/>
							</div>

							<div class="checkbox">
								<label for="add-pk">
									<input
										id="add-pk"
										type="checkbox"
										ng-model="$ctrl.addColumnModel.PK"
									/>{{ 'PK' | translate }}
								</label>
							</div>

							<div class="checkbox">
								<label for="add-fk">
									<input
										id="add-fk"
										type="checkbox"
										ng-model="$ctrl.addColumnModel.FK"
									/>{{ 'FK' | translate }}
								</label>
							</div>

							<div class="checkbox" ng-show="!$ctrl.addColumnModel.PK">
								<label for="add-not-null">
									<input
										id="add-not-null"
										type="checkbox"
										ng-model="$ctrl.addColumnModel.NOT_NULL"
									/>{{ 'NOT NULL' | translate }}
								</label>
							</div>
							<div class="checkbox" ng-show="!$ctrl.addColumnModel.PK && !$ctrl.addColumnModel.defaultValue">
								<label for="add-unique">
									<input
										id="add-unique"
										type="checkbox"
										ng-model="$ctrl.addColumnModel.UNIQUE"
									/>{{ 'UNIQUE' | translate }}
								</label>
							</div>

							<div class="checkbox" ng-show="!$ctrl.addColumnModel.FK && !$ctrl.addColumnModel.defaultValue">
								<label for="add-auto-increment">
									<input
										id="add-auto-increment"
										type="checkbox"
										ng-model="$ctrl.addColumnModel.AUTO_INCREMENT"
									/>{{ 'AUTO INCREMENT' | translate }}
								</label>
							</div>

							<div class="form-group clearfix" ng-show="$ctrl.addColumnModel.FK">
								<label for="">{{ 'Source' | translate }}</label>
									<dropdown
										on-select="$ctrl.selectAddTableOrigin(selected)"
										selected="{name: 'ORIGEM', type: 'ORIGEM'}"
										options="$ctrl.tableNames">
									</dropdown>
							</div>

							<div class="actions clearfix">
								<i class="fa fa-check-circle add" aria-hidden="true" ng-click="$ctrl.addColumn($ctrl.addColumnModel)"></i>
								<i class="fa fa-times-circle cancel" aria-hidden="true" ng-click="$ctrl.showAddColumn(false)"></i>
							</div>
						</div><!-- End .columnItem -->

						<div class="columnItem" ng-repeat="column in $ctrl.columns track by $index">
							<label
								draggable="true"
								ng-click="$ctrl.editionColumnMode(column, $index)"
								ng-show="!column.expanded"
							>{{column.name}}</label>
							<i
								class="fa fa-trash"
								aria-hidden="true"
								ng-click="$ctrl.deleteColumn(column, $index); $event.stopPropagation();"
							></i>

							<div class="columnDetails" ng-show="column.expanded">
								<div class="form-group">
									<label for="">{{ 'Name' | translate }}</label>
									<input
										id=""
										type="text"
										class="form-control"
										ng-model="$ctrl.editColumnModel.name"
									/>
								</div>

								<div class="form-group clearfix">
									<label for="">{{ 'Type' | translate }}</label>
										<dropdown
											on-select="$ctrl.selectEditType(selected)"
											selected="{name: column.type, type: column.type}"
											options="[{name: 'DATE', type: 'DATE'}, {name: 'FLOAT', type: 'FLOAT'}, {name: 'VARCHAR(n)', type: 'VARCHAR(n)'}, {name: 'CHAR(n)', type: 'CHAR(n)'},  {name: 'INT', type: 'INT'}]">
										</dropdown>
								</div>

								<div class="form-group" ng-show="!$ctrl.editColumnModel.PK && !$ctrl.editColumnModel.FK">
									<label for="edit-default">{{ 'Default' | translate }}</label>
									<input
										id="edit-default"
										type="text"
										class="form-control"
										ng-model="$ctrl.editColumnModel.defaultValue"
									/>
								</div>

								<div class="checkbox">
									<label for="edit-pk">
										<input
											id="edit-pk"
											type="checkbox"
											ng-model="$ctrl.editColumnModel.PK"
										/>{{ 'PK' | translate }}
									</label>
								</div>

								<div class="checkbox">
									<label for="edit-fk">
										<input
											id="edit-fk"
											type="checkbox"
											ng-model="$ctrl.editColumnModel.FK"
										/>{{ 'FK' | translate }}
									</label>
								</div>

								<div class="checkbox" ng-show="!$ctrl.editColumnModel.PK">
									<label for="edit-not-null">
										<input
											id="edit-not-null"
											type="checkbox"
											ng-model="$ctrl.editColumnModel.NOT_NULL"
										/>{{ 'NOT NULL' | translate }}
									</label>
								</div>

								<div class="checkbox" ng-show="!$ctrl.editColumnModel.PK && !$ctrl.editColumnModel.defaultValue">
									<label for="edit-unique">
										<input
											id="edit-unique"
											type="checkbox"
											ng-model="$ctrl.editColumnModel.UNIQUE"
										/>{{ 'UNIQUE' | translate }}
									</label>
								</div>

								<div class="checkbox" ng-show="!$ctrl.editColumnModel.defaultValue && !$ctrl.editColumnModel.FK">
									<label for="edit-auto-increment">
										<input
											id="edit-auto-increment"
											type="checkbox"
											ng-model="$ctrl.editColumnModel.AUTO_INCREMENT"
										/>{{ 'AUTO INCREMENT' | translate }}
									</label>
								</div>

								<div class="form-group clearfix" ng-show="$ctrl.editColumnModel.FK">
									<label for="">{{ 'Source' | translate }}</label>
										<dropdown
											on-select="$ctrl.selectAddTableOrigin(selected)"
											selected="{name: 'ORIGEM', type: 'ORIGEM'}"
											options="$ctrl.tableNames">
										</dropdown>
								</div>

								<div class="actions clearfix">
									<i class="fa fa-check-circle add" aria-hidden="true" ng-click="$ctrl.editColumn(column, $ctrl.editColumnModel, $index); $ctrl.expanded=!$ctrl.expanded;"></i>
									<i class="fa fa-times-circle cancel" aria-hidden="true" ng-click="column.expanded=!column.expanded"></i>
								</div>
							</div><!-- End .columnDetails -->
						</div><!-- End .columnItem -->
					</section><!-- End .columnsList -->

					<div ng-show="selectedLink != null">
						<div class="form-group">
							<label>{{ 'Cardinality' | translate }}</label>
							<div
								class="dropdown-tmp dropdown-tmp-btn"
								broption=""
								tabindex="0"
							>
								<div class="dropdown-tmp-trigger">
									<button class="btn ng-binding">{{$ctrl.selectedLink.a.card}}</button>
								</div>
								<ul class="dropdown-tmp-list" style="min-width: 140px;">
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardA('(0, 1)')">
										<span>(0, 1)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardA('(0, n)')">
										<span>(0, n)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardA('(1, 1)')">
										<span>(1, 1)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardA('(1, n)')">
										<span>(1, n)</span>
									</li>
								</ul>
							</div>
						</div><!-- End .form-group -->

						<div class="form-group">
							<label for=" ">{{ 'Cardinality' | translate }}</label>
							<div
								class="dropdown-tmp dropdown-tmp-btn"
								broption=""
								tabindex="0"
							>
								<div class="dropdown-tmp-trigger">
									<button class="btn ng-binding">{{$ctrl.selectedLink.b.card}}</button>
								</div>
								<ul class="dropdown-tmp-list" style="min-width: 140px;">
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardB('(0, 1)')">
										<span>(0, 1)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardB('(0, n)')">
										<span>(0, n)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardB('(1, 1)')">
										<span>(1, 1)</span>
									</li>
									<li class="dropdown-tmp-item" ng-click="$ctrl.updateCardB('(1, n)')">
										<span>(1, n)</span>
									</li>
								</ul>
							</div>
						</div>
					</div>

				</div><!-- End .properties-content -->
			</aside><!-- End .model-properties -->
		</section><!-- End .model-area -->
		<status-bar updated-at="$ctrl.modelState.updatedAt"></status-bar>
		<bug-report-button></bug-report-button>

	</section><!-- End .mainContent -->
</section><!-- End .view -->